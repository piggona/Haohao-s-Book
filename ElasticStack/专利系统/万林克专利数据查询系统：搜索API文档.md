# 万林克专利数据查询系统：搜索API文档(Elasticsearch)

- ## 主要请求条目（功能）

  ## 1. 基础查询

  | 序号 | 功能项目             | 是否固定    | 输入                        | 输出             | 备注             |
  | ---- | -------------------- | ----------- | --------------------------- | ---------------- | ---------------- |
  | 01-a | 查询类型选择（basic) | 是          | -                           | -                | -                |
  | 01-b | 查询范围选择         | 否(enum)    | patent/paper/nsf/org/person | -                | -                |
  | 01-c | 查询方式选择         | 否(enum)    | id/name                     | -                | -                |
  | 01-d | 查询内容             | 否（opcode) | text                        | -                | -                |
  | 01-e | 查询                 | 是          | execute                     | 简略搜索结果列表 |                  |
  | 01-f | 翻页                 | 是          | execute                     | 简略搜索结果列表 | 根据当前页面出发 |

  简略搜索列表项：

  | 公开号 | 标题 | 专利权人/申请人 | 公开日期 | 现版IPC |
  | ------ | ---- | --------------- | -------- | ------- |
  |        |      |                 |          |         |

  输出格式：

  | 项目            | 类型    | 备注（用途）       |
  | --------------- | ------- | ------------------ |
  | 公开号          | string  | 展示/缓存          |
  | 标题            | string  | 展示               |
  | 专利权人/申请人 | string  | 展示               |
  | 公开日期        | date    | 展示               |
  | 现版IPC         | string  | 展示               |
  | 当前页面        | integer | 缓存当前展示的页面 |



  ## 2. 高级/二次查询

  | 序号 | 功能项目               | 是否固定   | 输入                                        | 输出             | 备注                              |
  | ---- | ---------------------- | ---------- | ------------------------------------------- | ---------------- | --------------------------------- |
  | 02-a | 查询类型的选择（prime) | 是         | -                                           | -                |                                   |
  | 02-b | 查询项目的选择         | 否（set)   | [ 发明人搜索, 国家搜索，类型搜索，时间搜索] | -                | 根据01b确定不同set,可以存在重复项 |
  | 02-c | 查询方式               | 否(set)    | [AND,OR]                                    | -                | 每个02b都对应一个                 |
  | 02-d | 查询内容               | 否(opcode) | text                                        | -                | 每个02b都对应一个                 |
  | 02-e | 查询                   | 是         | execute                                     | 简略搜索结果列表 |                                   |
  | 02-f | 翻页                   | 是         | execute                                     | 简略搜索结果列表 | 根据当前页面出发                  |



  ## 3. 详情查询（专利）

  | 序号 | 功能项目 | 是否固定 | 输入    | 输出                | 备注 |
  | ---- | -------- | -------- | ------- | ------------------- | ---- |
  | 03-a | 查询id   | 否       | id      | -                   |      |
  | 03-b | 查询     | 是       | execute | filter_path搜索结果 |      |

  搜索结果项目：

  | 项目           | 类型                                                   | 备注/用途                                      |
  | -------------- | ------------------------------------------------------ | ---------------------------------------------- |
  | 专利名         | string                                                 | 展示                                           |
  | 简介           | string                                                 | 展示                                           |
  | 申请号码       | string                                                 | 展示                                           |
  | 公开号         | string                                                 | 展示                                           |
  | 申请日期       | date                                                   | 展示                                           |
  | 公开日期       | date                                                   | 展示                                           |
  | 专利类型       | string                                                 | 展示                                           |
  | 分类类型（CPC) | string+url                                             | 展示+链接                                      |
  | 分类类型(NBER) | string+url                                             | 展示+链接                                      |
  | 分类类型(USPC) | string+url                                             | 展示+l                                         |
  | 分类类型       | list[{enum+string+url},]                               | 如果分类类型的种类不一定，也可以以列表形式传递 |
  | 发明人         | list[{string`名字`+string`机构`+url`个人`+url`机构`},] | 展示+链接                                      |
  | 专利权人       | list[{string`名字`+string`机构`+url`个人`+url`机构`},] | 展示+链接                                      |



  ## 4. 聚类分析接口(需要讨论分析的项目)

  | 序号 | 功能项目 | 是否固定 | 输入    | 输出                    | 备注 |
  | ---- | -------- | -------- | ------- | ----------------------- | ---- |
  | 04-a | 查询id   | 否       | id      | -                       |      |
  | 04-b | 查询     | 是       | execute | _source_include搜索结果 |      |



  ## 5. 通用功能

  搜索结果的排序是否需要在elasticsearch中实现，还是javascript做，衡量效率。

- ## 搜索流程请求模板（API请求）

  ## 1. 基础查询：

  ```bash
  //默认时间排序
  
  POST {ES地址}/{索引名}/_search
  
  { 
    "_source": ["patent_uuid", "documentId", "title", "assignees.name.raw", "publishedDate", "classification.ipc.raw"],
    "sort": 
    #按相关度排序
    {
      "_score": "desc"
    },
    #按时间排序
    {
      "publishedDate" : "desc"
    },
    "from": .....,
    "size": .....,
    "query":{
      "bool":{
        "must":[
          {
            "match": {
              "{字段名}": "{关键字,多个关键字用空格分隔}",
              "operator": "多个关键字至少有一个用or，全都有用and"
            }
          },
          .
          .
          .
          .
        ]
      }
    }
  }
  ```





  ## 2. 高级/二次查询

  ```bash
  //相关度排序
  
  GET /{{01-b}}/_search
  {
      "sort":[
          {"date":"desc"}
      ],
      "source":{
          "includes":["patent_uuid","name","date","country","type"],
          "excludes":[]
      },
      "query":{
          "term":{"{{01-c}}":"{{02-d}}"}
      },
      "from":{{01-f}},"size":20
  }
  ```