# 运维基础

> 运维主要的工作就是在保证服务质量

## 计算机硬件的速度

CPU->

Cache L1->

Cache L2（延时：0.5-15ns,带宽：20-60GB/s）->

内存（延时30-100ns,带宽2-12GB/s）->

SSD硬盘（延时：$10\mu s-1ms$,带宽：50MB-2GB/s）->

普通硬盘（延时：5-20ms，带宽：50-200MB/s）->

网络服务（延时：$100\mu s-1ms$，带宽：10MB-10GB/s）

> 运维人员需要正确调配资源，将用户更大概率需要的资源 分布到 访问效率更高的存储介质中（如内存中）
>
> 运维人员的职责：
>
> 1. 服务7*24小时都可以访问
> 2. 数据不能丢
> 3. 用户体验尽量好

## 服务器自动安装系统（Cobbler，KickStart自动批量安装）

> 如今为服务器配置系统已经用不到光驱，usb等设施，只需要能通电接网线就可以为服务器批量安装系统。
>
> 为节省电力，可以去掉光驱和usb等浪费电力的硬件。

## 服务器品牌

### Dell:

#### 2010-2013:

> 1u=4.445cm

1u: R410,R610

2u:R710

#### 2016:

1u:R420/R430,R620/R630

2u:R720/R730

### IBM:

2U:3650

3U:3850

8U:3950

### HP:

DL380G7/G8

> 选择1u还是2u的服务器？
>
> 如果供电能力不足，选择2u服务器，
>
> 如果偏向存储，选择密集存储2u-4u服务器，
>
> 如果供电充足，且偏向计算，则需要将服务器密集化，使用1u服务器。

![image-20190117082441176](/Users/haohao/Documents/Haohao's-Book/运维课程/assets/image-20190117082441176.png)

![image-20190117082501074](/Users/haohao/Documents/Haohao's-Book/运维课程/assets/image-20190117082501074.png)

![image-20190117082546622](/Users/haohao/Documents/Haohao's-Book/运维课程/assets/image-20190117082546622.png)

![image-20190117082602488](/Users/haohao/Documents/Haohao's-Book/运维课程/assets/image-20190117082602488.png)

![image-20190117082628826](/Users/haohao/Documents/Haohao's-Book/运维课程/assets/image-20190117082628826.png)



## 服务器主要零件：

### 1.电源：

生产中一般采用单个服务器核心业务使用双电源，双路（AB)

> 双路AB的意思是从两个地方供电（两个供电源，防止一方断电）

集群可以不用双电源

### 2.CPU:

企业服务器，CPU2-4颗，单颗CPU4核。内存总量是16-256G(32,64常见)。

虚拟化的宿主机，CPU4-8颗，内存总量一般是48-128G,6-10个虚拟机。

### 3. 内存：

> 内存是速度与容量相对最平衡的存储设备，但其断电就会将数据丢失。

#### 大并发写入：

高并发、大数据量写数据：会把数据先写入内存，积累一定的量之后，再定时或者定量的写到磁盘（减少磁盘I/O）

特点：

- 优点：写数据到内存，性能高速度快

- 缺点：可能会丢失一部分在内存中还没有来得及存入磁盘的数据

  解决方法：

  1. 服务器主板上安装电池，再断电瞬间把内存数据回写到磁盘。
  2. UPS不间断供电
  3. 选双路电的机房
  4. 服务器避免单点提供服务，服务器放到不同的机柜、地区
  5. 集群提供服务

#### 并发不是很大，读多写少的业务：

先把数据写到磁盘，然后再通过程序把写到磁盘的数据读入到内存里，再对外通过读内存提供访问服务。

#### Buffer和Cache

写入数据到内存里，这个数据的内存空间称为缓冲区（buffer）

从内存读取数据，这个存数据的内存空间称为缓存区（cache）

### 4. 磁盘

> 性能与价格：SSD>SAS>SATA

企业级服务器应用：

1. 常规正式工作场景主选SAS（结合SATA与SCSI的优点）硬盘（转速是15000转/分）
2. 不对外提供访问的服务器（线下的数据备份）可以选择SATA（7200-10000转/分）
3. 高并发访问，选择SSD

> 几乎企业运维和架构师的网站优化、服务器、软件的优化核心，都是磁盘和内存的使用比例优化。

### 5. RAID阵列

> RAID有多种整合方式,RAID:0,1,5,10
>
> 使用RAID，磁盘插到RAID卡上

RAID 0：500G+500G = 1000G，速度快

RAID 1:只能两块盘（大小可以不同），600G+500G=500G，备份盘

RAID 5:至少三块盘，有一定的容错能力（可以接受一块盘的丢失），速度慢(介于RAID0,RAID1之间)

RAID 10：至少4块盘，容量也是二分之一，相当于将盘做RAID0（或RAID1）之后做RAID1(RAID0),冗余（容错）两块盘，读写性能不错。

#### 互联网公司：

单台服务器：系统盘RAID1

数据库服务器，主库raid10,从库：raid5/raid0

web服务：如果没有太多数据，raid5,raid0（单盘）